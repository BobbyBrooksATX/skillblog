---
title: A Cross-section Analysis of Singapore's Population Using Aggregate Regions
author: Timothy Lin
draft: true
date: '2017-09-26'
slug: a-cross-section-analysis-of-singapore-s-population-using-aggregate-regions
categories: []
tags: ["Singapore", "R", "spatial", "sg-social"]
subtitle: ''
---



<p>&lt;!–</p>
<div id="applying-it-to-singapores-data" class="section level3">
<h3>Applying it to Singapore’s Data</h3>
<p>In this section, I apply the group regression methodology method outlined above to estimate the underlying correlation across certain population characteristics. I will be using data from the Singapore Census, which was also used in my previous visualisation <a href="/2017/09/10/examining-the-changes-in-religious-beliefs-part-2/">pieces</a> and can be downloaded from the following <a href="https://github.com/timlrx/sg-mapping">link</a>(SG_region_data_clean.rds).</p>
<p>Selecting the right variables to study is more of a problem due to the strong assumptions needed and described above. While income and housing would be interesting issues to examine, it is almost a certainity that people sort into regions base on their income, with higher earning individuals more likely to be located nearer to the city than their lower earning counterparts. This makes an aggregate level regression of income on housing quite pointless. Instead, I will explore the relationship between race and religion. This requires assuming that people do not select into regions base on race or religion.</p>
</div>
<div id="pre-processing" class="section level3">
<h3>Pre-processing</h3>
<p>After reading in the data file, we will first need to extract the relevant variables for the analysis. To do so, we can use the <code>SelectData</code> function which I modified to include an option to output the selected data in either wide or long format. While the wide format is more useful for visualisation purposes, here I extract the data in a long format to build a panel.</p>
<pre class="r"><code>#&#39; This function extracts the required variables in wide form.
#&#39; @param df dataframe containing the cleaned region data.
#&#39; @param name name of content that is extracted
#&#39; @param variable either &quot;Value&quot; or &quot;prop&quot;
#&#39; @param year_opt either &quot;wide&quot; or &quot;long&quot;
#&#39; @return data extract in wide form.
SelectData &lt;- function(df, name, variable, year_opt){
  
  data_total &lt;- df%&gt;%
    filter(content==name &amp; Level_1==&quot;Total&quot; &amp; Level_2==&quot;Total&quot;) %&gt;%
    rename(total = Value) %&gt;%
    dplyr:: select(Year, Level_3, total)
  
  data &lt;- df%&gt;%
    filter(content==name &amp; Level_1!=&quot;Total&quot;) %&gt;%
    left_join(data_total, by=c(&quot;Year&quot;, &quot;Level_3&quot;)) %&gt;%
    mutate(prop = Value/total *100,
           Level_3 = toupper(Level_3))
  
  if(length(unique(data$Level_2))==1){
    form &lt;- ifelse(year_opt==&quot;wide&quot;, &quot;Level_3 ~ Level_1 + Year&quot;, 
                   ifelse(year_opt==&quot;long&quot;, &quot;Year + Level_3 ~ Level_1&quot;,
                          stop(&quot;Invalid year option&quot;)))
    data_wide &lt;- data %&gt;%
      dplyr::select(Level_1, Level_3, get(variable), Year) %&gt;%
      dcast(as.formula(form), value.var=variable)
    vec_names &lt;- unique(data$Level_1)
    } else{
    form &lt;- ifelse(year_opt==&quot;wide&quot;, &quot;Level_3 ~ Level_1 + Level_2 + Year&quot;, 
                     ifelse(year_opt==&quot;long&quot;, &quot;Year + Level_3 ~ Level_1 + Level_2&quot;,
                            stop(&quot;Invalid year option&quot;)))
    data_wide &lt;- data %&gt;%
      dplyr::select(Level_1, Level_2, Level_3, get(variable), Year) %&gt;%
      dcast(as.formula(form), value.var=variable)
    vec_names &lt;- as.vector(outer(unique(data$Level_1), unique(data$Level_2), paste, sep=&quot;_&quot;))
    }
  
  if(year_opt==&quot;wide&quot;){
    tryCatch(  
      for(i in 1:length(vec_names)){
        data_wide[,paste0(vec_names[i], &quot;_diff&quot;)] &lt;- 
          data_wide[,paste0(vec_names[i], &quot;_2015&quot;)] - data_wide[,paste0(vec_names[i], &quot;_2000&quot;)]
      }, 
      error = function(e) print(&quot;Err: Not all columns have data in 2015 and 2000&quot;))
    return(data_wide)
  }
  return(data_wide)
}</code></pre>
<p>I extract the main variables of interest (race, religion, income, housing) and merge them to create a panel where the rows correspond to the average proportion of a selected group living in a particular area of interest. I also binned data on income at the household level into 3 categories (proportion of households with an income less than the 20th percentile, 50th percentile and 80th percentile).<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>df2 &lt;- df %&gt;% filter(Level_2 == &quot;Total&quot;) 
religion_data &lt;- SelectData(df2, &quot;resident_pop_religion&quot;, &quot;prop&quot;, &quot;long&quot;)
religion_data$Christianity  &lt;- religion_data$`Christianity Catholic` +
  religion_data$`Christianity Other Christians`
ethnic_data &lt;- SelectData(df2, &quot;resident_pop_ethnic_sex&quot;, &quot;prop&quot;, &quot;long&quot;)
dwelling_data &lt;- SelectData(df2, &quot;resident_hh_dwelling&quot;, &quot;prop&quot;, &quot;long&quot;)
income_data &lt;- SelectData(df2, &quot;resident_hh_income&quot;, &quot;prop&quot;, &quot;long&quot;)

### Group income into 3 bins &lt;20%, &lt;50%, &lt;80%
### Assume uniform distribution across each range
## 2000: 20% - 2241, 50% - 4505, 80% - 7608  data max 8000 over
## 2010: 20% - 2940, 50% - 6603, 80% - 11105 data max 10000 over
## 2015: 20% - 3815, 50% - 8733, 80% - 14929 data max 20000 over

income_data$pc20 &lt;- ifelse(income_data$Year==2000, income_data$`Below $1,000` +
                           income_data$`$1,000 $1,999` + 0.241*income_data$`$2,000 $2,999`,
                    ifelse(income_data$Year==2010, income_data$`Below $1,000` +
                           income_data$`$1,000 $1,999` + 0.94*income_data$`$2,000 $2,999`,
                    ifelse(income_data$Year==2015, income_data$`Below $1,000` +
                           income_data$`$1,000 $1,999` + income_data$`$2,000 $2,999` +
                           0.815*income_data$`$3,000 $3,999`,NA)))
                             
income_data$pc50 &lt;- ifelse(income_data$Year==2000, income_data$`Below $1,000` +
                           income_data$`$1,000 $1,999` + income_data$`$2,000 $2,999` + income_data$`$3,000 $3,999` +
                           0.505*income_data$`$4,000 $4,999`,
                    ifelse(income_data$Year==2010, income_data$`Below $1,000` + income_data$`$1,000 $1,999` +
                           income_data$`$2,000 $2,999` + income_data$`$3,000 $3,999` +
                           income_data$`$4,000 $4,999` + income_data$`$5,000 $5,999` + 
                           0.603*income_data$`$6,000 $6,999`,
                    ifelse(income_data$Year==2015, income_data$`Below $1,000` + income_data$`$1,000 $1,999` +
                           income_data$`$2,000 $2,999` + income_data$`$3,000 $3,999` +
                           income_data$`$4,000 $4,999` + income_data$`$5,000 $5,999` + 
                           income_data$`$6,000 $6,999` + income_data$`$7,000 $7,999` +
                           0.733*income_data$`$8,000 $8,999`, NA)))
                                                                    
income_data$pc80 &lt;- ifelse(income_data$Year==2000, 100 - income_data$`$8,000 &amp; Over` ,
                    ifelse(income_data$Year==2010, 100 - income_data$`$10,000 &amp; Over`,
                    ifelse(income_data$Year==2015, 100 - income_data$`$20,000 &amp; Over` -
                           income_data$`$17,500 $19,999` - income_data$`$15,000 $17,499`, NA)))

income_data &lt;- income_data %&gt;%
  dplyr::select(Year, Level_3, pc20, pc80, pc50)

# dwelling_data$check &lt;- rowSums( dwelling_data[,c(3,8:10)], na.rm=TRUE)
df_panel &lt;- religion_data %&gt;%
  left_join(ethnic_data, by = c(&quot;Year&quot;, &quot;Level_3&quot;)) %&gt;%
  left_join(dwelling_data, by = c(&quot;Year&quot;, &quot;Level_3&quot;)) %&gt;%
  left_join(income_data, by = c(&quot;Year&quot;, &quot;Level_3&quot;))

df_panel_2015 &lt;- df_panel[df_panel$Year==2015,]</code></pre>
</div>
<div id="analysis" class="section level3">
<h3>Analysis</h3>
<p>Now, we are ready to run some regressions. First, let us take a look at the correlation between race and religion. To get more power for the test, I pool the data across the 3 survey years and control for year fixed effect. Clustering the standard errors by regions also adjust the covariance matrix to account for correlation across years for a particular region.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Note: This is compared with the national household income distribution. As income data by region is released in income bands, I assume a uniform distribution when calculating the percentage of people who fall into a particular category.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
