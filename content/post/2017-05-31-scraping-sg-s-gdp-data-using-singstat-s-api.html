---
title: Scraping SG's GDP data using SingStat's API
author: Timothy Lin
date: '2017-05-31'
slug: scraping-sg-s-gdp-data-using-singstat-s-api
categories: []
tags: ["Singapore","SG Economy","Web-Scraping","R"]
subtitle: ''
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<link href="/rmarkdown-libs/plotlyjs/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotlyjs/plotly-latest.min.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>


<p>I have been trying to catch-up on the latest release of Singapore’s economic results. Unfortunately, the official press release or media reports are not very useful. They either contain too much irrelevant information or not enough details for my liking. Maybe I just like looking at the numbers and letting the figures speak for themselves. Hence, I decided to obtain the data from the official SingStat’s Table Builder website. Turns out that they have an API available that provides data for selected data series including the <a href="http://www.tablebuilder.singstat.gov.sg/publicfacing/initApiList.action">GDP figures</a>.</p>
<p>This makes it easy to obtain the required data without having to navigate through the complicated tree structure of table builder. The best part about having an API is that I can just re-run the same set of codes and produce my own customise GDP report tailored to my liking! For the first technical post of this blog, I decided to do a write-up on using the API to extract GDP figures and generate some graphs in R. A more detailed set of codes is available on <a href="https://github.com/timlrx/sg-econ-api">github</a>.</p>
<p>I use the <code>httr</code> package to read in JSON data before manipulating the data in <code>dplyr</code> and <code>reshape2</code>. <code>ggplot2</code> is used for graphing and to add a little interactivity we can also play around with the <code>plotly</code> package. First, we have to read in the JSON data and convert it to string format. I decided to read in both the seasonally-adjusted VA figures and raw VA figures as they are used to calculate quarter-on-quarter and year-on-year growth respectively.</p>
<pre class="r"><code>library(httr)
library(reshape2)
library(dplyr)
library(ggplot2)

url_va_sa  &lt;- &quot;http://www.tablebuilder.singstat.gov.sg/publicfacing/api/json/title/12411.json&quot;
url_va  &lt;- &quot;http://www.tablebuilder.singstat.gov.sg/publicfacing/api/json/title/12407.json&quot;

raw.result &lt;- GET(url=url_va_sa)
names(raw.result)</code></pre>
<pre><code>##  [1] &quot;url&quot;         &quot;status_code&quot; &quot;headers&quot;     &quot;all_headers&quot; &quot;cookies&quot;    
##  [6] &quot;content&quot;     &quot;date&quot;        &quot;times&quot;       &quot;request&quot;     &quot;handle&quot;</code></pre>
<pre class="r"><code>raw.content &lt;- rawToChar(raw.result$content) # Convert raw bytes to string
raw.content &lt;- content(raw.result)
# levels correspond to the statistics level of aggregation
# 1 - overall economy, 2 - goods / services, 3 - sector level</code></pre>
<p>Browsing the raw.content variable, we can see that it is a messy list of lists.</p>
<pre class="r"><code>names(raw.content)</code></pre>
<pre><code>##  [1] &quot;Level1&quot;            &quot;Level2&quot;            &quot;Level3&quot;           
##  [4] &quot;Note&quot;              &quot;VariableFootNotes&quot; &quot;Unit&quot;             
##  [7] &quot;Datesource&quot;        &quot;GeneratedBy&quot;       &quot;DateGenerated&quot;    
## [10] &quot;Contact&quot;</code></pre>
<p>Level1, Level2, Level3 contain the data we are interested in at various levels of industry aggregation. Let’s convert it to a more managable dataframe format and extract the required data. The do.call function along with lapply helps to unpack the list.</p>
<pre class="r"><code>data &lt;- do.call(what = &quot;rbind&quot;, args = lapply(raw.content$Level1, as.data.frame))
data.sector &lt;- do.call(what = &quot;rbind&quot;, args = lapply(raw.content$Level3, as.data.frame))
data$value &lt;- as.numeric(as.character(data$value))
data.sector$value &lt;- as.numeric(as.character(data.sector$value))
data &lt;- data[,c(&quot;quarter&quot;,&quot;value&quot;)]
data.sector &lt;- data.sector[,c(&quot;quarter&quot;,&quot;value&quot;,&quot;level_3&quot;)]
names(data)[names(data) == &#39;quarter&#39;] &lt;- &#39;period&#39;
names(data.sector)[names(data.sector) == &#39;quarter&#39;] &lt;- &#39;period&#39;
names(data.sector)[names(data.sector) == &#39;level_3&#39;] &lt;- &#39;industry&#39;</code></pre>
<p>Now we can use the levels data and calculate the quarter-on-quarter seasonally-adjusted annualised growth rate (qoqsaa).</p>
<pre class="r"><code>data &lt;- data %&gt;% mutate(qoqsaa = ((value/lag(value))^4-1)*100)
data.sector &lt;- data.sector %&gt;% group_by(industry) %&gt;% 
               mutate(qoqsaa = ((value/lag(value))^4-1)*100) %&gt;% ungroup()</code></pre>
<p>We can repeat the process for the non-seasonally-adjusted data and calculate the year-on-year growth rates.[Code omitted due to repetition.]</p>
<p>Let’s take a look at some plots of the data.</p>
<pre class="r"><code>ggplot(data[(nrow(data)-16+1):nrow(data),], aes(period, qoqsaa, group=1)) +
  geom_point() + geom_line() + ylab(&quot;QoQ SA (%)&quot;) + xlab(&quot;Period&quot;) + theme_classic() +
  theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1))</code></pre>
<div class="figure"><span id="fig:qoqsaplot"></span>
<img src="/post/2017-05-31-scraping-sg-s-gdp-data-using-singstat-s-api_files/figure-html/qoqsaplot-1.png" alt="QoQ GDP Trend" width="672" />
<p class="caption">
Figure 1: QoQ GDP Trend
</p>
</div>
<p>And here’s a plot comparing qoq and yoy growth for all the industries:</p>
<p><img src="/post/2017-05-31-scraping-sg-s-gdp-data-using-singstat-s-api_files/figure-html/reshapeplot-1.png" width="672" /></p>
<p>Wondering what the actual percentage change is? We can convert the graph into a more interactive one using a simple line of code. And since it is locally generated, it can be hosted on github as well.</p>
<pre class="r"><code>library(plotly)
ggplotly(sector.bar)</code></pre>
<div id="10d426265ff6" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="10d426265ff6">{"x":{"data":[{"orientation":"h","width":[0.45,0.45,0.45,0.45,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999],"base":[0,0,0,0,-1.88761119548709,0,0,-16.3841807909604,0,-1.35401740286171,0,0],"x":[2.25935661534611,2.08086016952358,0.939958688235421,1.65226985280267,1.88761119548709,4.22622829309616,0.468887039827304,16.3841807909604,0.596695226438193,1.35401740286171,8.04324664209735,2.71468110269821],"y":[0.75,1.75,2.75,3.75,4.75,5.75,6.75,7.75,8.75,9.75,10.75,11.75],"text":["series: yoy<br />industry.short: Other Ser<br />value:  2.2593566","series: yoy<br />industry.short: Business Ser<br />value:  2.0808602","series: yoy<br />industry.short: F&I<br />value:  0.9399587","series: yoy<br />industry.short: Infocomms<br />value:  1.6522699","series: yoy<br />industry.short: Acc & Food<br />value:  1.8876112","series: yoy<br />industry.short: Tpt & Storage<br />value:  4.2262283","series: yoy<br />industry.short: Wholesale Retail<br />value:  0.4688870","series: yoy<br />industry.short: Other Goods<br />value: 16.3841808","series: yoy<br />industry.short: Utilities<br />value:  0.5966952","series: yoy<br />industry.short: Construction<br />value:  1.3540174","series: yoy<br />industry.short: Mfg<br />value:  8.0432466","series: yoy<br />industry.short: Overall<br />value:  2.7146811"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"yoy","legendgroup":"yoy","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"h","width":[0.45,0.45,0.45,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999,0.449999999999999],"base":[-1.61857654839587,0,-17.7950559873076,0,-5.22110109145527,0,-2.3891712522074,-50.1331248592103,0,0,-1.46459757223216,-1.27671396745511],"x":[1.61857654839587,13.0799932250826,17.7950559873076,5.17655516103213,5.22110109145527,0.150155760199011,2.3891712522074,50.1331248592103,0.499686722888115,4.31781436378906,1.46459757223216,1.27671396745511],"y":[1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25],"text":["series: qoqsaa<br />industry.short: Other Ser<br />value:  1.6185765","series: qoqsaa<br />industry.short: Business Ser<br />value: 13.0799932","series: qoqsaa<br />industry.short: F&I<br />value: 17.7950560","series: qoqsaa<br />industry.short: Infocomms<br />value:  5.1765552","series: qoqsaa<br />industry.short: Acc & Food<br />value:  5.2211011","series: qoqsaa<br />industry.short: Tpt & Storage<br />value:  0.1501558","series: qoqsaa<br />industry.short: Wholesale Retail<br />value:  2.3891713","series: qoqsaa<br />industry.short: Other Goods<br />value: 50.1331249","series: qoqsaa<br />industry.short: Utilities<br />value:  0.4996867","series: qoqsaa<br />industry.short: Construction<br />value:  4.3178144","series: qoqsaa<br />industry.short: Mfg<br />value:  1.4645976","series: qoqsaa<br />industry.short: Overall<br />value:  1.2767140"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"qoqsaa","legendgroup":"qoqsaa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":25.7412480974125,"r":7.30593607305936,"b":39.6955859969559,"l":119.086757990868},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-53.2937807634249,16.2406491292972],"tickmode":"array","ticktext":["-40","-20","0"],"tickvals":[-40,-20,0],"categoryorder":"array","categoryarray":["-40","-20","0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"Growth (%)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[0.4,12.6],"tickmode":"array","ticktext":["Other Ser","Business Ser","F&I","Infocomms","Acc & Food","Tpt & Storage","Wholesale Retail","Other Goods","Utilities","Construction","Mfg","Overall"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12],"categoryorder":"array","categoryarray":["Other Ser","Business Ser","F&I","Infocomms","Acc & Food","Tpt & Storage","Wholesale Retail","Other Goods","Utilities","Construction","Mfg","Overall"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"Industry","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.93503937007874},"annotations":[{"text":"series","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"source":"A","attrs":{"10d462a57186":{"fill":{},"x":{},"y":{},"type":"bar"}},"cur_data":"10d462a57186","visdat":{"10d462a57186":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<p>While the precision of our calculated data is satisfying, the scale of the graph is being skewed by one particular sector. The other goods sector (Agriculture and Fishing, Mining and Quarrying) contracted 16.38% yoy (yikes!).<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> The other goods sector is normally not given any coverage as it is a very small component of GDP (just 30m). Could the decline be mostly due to noisy fluctuations?</p>
<pre class="r"><code>other.goods.data &lt;- va.sector.comb %&gt;% filter(year&gt;=2012 &amp; industry==&quot;Other Goods Industries&quot;)                     %&gt;% select(period, yoy, qoqsaa) %&gt;% melt(measure.vars=c(&quot;yoy&quot;,&quot;qoqsaa&quot;))

other.goods.plot&lt;-ggplot(other.goods.data, aes(period, value, group=variable, color=variable)) + geom_point() + geom_line() + ylab(&quot;QoQ SA (%)&quot;) + xlab(&quot;Period&quot;) + theme_classic() +        theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1))</code></pre>
<p>Not suprisingly there is a downward trend in the sector, but the recent quarter’s dip is the sharpest in all 4 years that I have plotted. The drastic decline in quarter-on-quarter VA figures for the finance and insurance industry is of potentially greater concern. Let’s take a closer look by plotting an extended time series.</p>
<div class="figure"><span id="fig:fi"></span>
<img src="/post/2017-05-31-scraping-sg-s-gdp-data-using-singstat-s-api_files/figure-html/fi-1.png" alt="yoy plot" width="672" />
<p class="caption">
Figure 2: yoy plot
</p>
</div>
<div class="figure"><span id="fig:fi"></span>
<img src="/post/2017-05-31-scraping-sg-s-gdp-data-using-singstat-s-api_files/figure-html/fi-2.png" alt="qoq plot" width="672" />
<p class="caption">
Figure 2: qoq plot
</p>
</div>
<p>Interestingly, from the yoy data it appears that the contribution of finance and insurance to Singapore’s GDP growth is plateauing off. The qoq data is even more suprising showing a strong cyclical pattern since 2014. This is of particular concern as the F&amp;I figures are not seasonally-adjusted. DOS believes that the sector does not exhibit seasonality, but looking at the recent data, a case could be made that the fundamentals of the sector has changed substantially over the past 3 years and one should definitely treat the qoq figures extremely cautiously.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I manually verified the figures with the official ones due to this huge number.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
